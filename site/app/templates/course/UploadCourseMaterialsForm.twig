{% extends 'generic/Popup.twig' %}
{% block popup_id %}upload-course-materials-form{% endblock %}
{% block title %}Upload Course Materials{% endblock %}
{% block body %}
    <div id="material-upload-form" class="flex-col flex-col-space">
        <p>
            <strong>Path to directory containing course materials file(s):</strong><br />
            {{ folderPath~'/'~courseMaterial }}
        </p>
        <label id="cm_path">
            <p>
                <strong>Optional: ammend the above path to use a sub directory</strong><br />
                e.g. "optional/subdirectory" makes the full path:<br />
                {{ folderPath~'/'~courseMaterial }}optional/subdirectory
            </p>
            <input type="text" id="input-provide-full-path" class="full-width" name="eg_config_path" value="" placeholder="optional/subdirectory"/>
        </label>
        <label>
            <input id="expand-zip-checkbox" type="checkbox" value="off"/>
            Unzip zip files (Note: If checked, will replace all folders/files)
        </label>
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <div id="upload-boxes">
            {# upload1 and input_file1 required for drag-and-drop.js #}
            <div id="upload1" class="file-input">
                <label class="label" for="input-file">"Drag your file(s) here or click to open file browser"</label>
                <input type="file" name="files" id="input_file1" onchange="addFilesFromInput(1,false)" multiple />
            </div>
        </div>
        <p>Total files cannot exceed 10 mb or 10240 kb.</p>
    </div>
    <script type="text/javascript">
        function makeSubmission(expandZip,cmPath, requestedPath) {
            handleUploadCourseMaterials("{{ csrf_token }}", expandZip, cmPath, requestedPath);
        }
        $(function() {
            $("#submit-materials").click(function(e){ // Submit button
                var cb = $("input#expand_zip_checkbox");
                var expandZip = 'off';
                if (cb.is(":checked")) {
                    expandZip = 'on';
                }

                var cmPath = document.getElementById('cm_path').innerHTML;

                var requestedPath = document.getElementById("input-provide-full-path").value;
                makeSubmission(expandZip, cmPath, requestedPath);
                e.stopPropagation();
            });
        });
    </script>
    <script type="text/javascript">
        createArray(1);
        var dropzone = document.getElementById("upload1");
        dropzone.addEventListener("click", clicked_on_box, false);
        dropzone.addEventListener("dragenter", draghandle, false);
        dropzone.addEventListener("dragover", draghandle, false);
        dropzone.addEventListener("dragleave", draghandle, false);
        dropzone.addEventListener("drop", dropWithMultipleZips, false);
    </script>
{% endblock %}
{% block buttons %}
    {{ block('close_button') }}
    <input class="btn btn-primary" id="submit-materials" type="submit" value="Submit" />
{% endblock %}
