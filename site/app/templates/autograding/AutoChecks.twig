{% import _self as self %}

{% for check in checks %}
    {% if loop.index0 != 0 %}
        <div class="clear"></div>
    {% endif %}
    {% if check.pdf %}
        <iframe src="{{ core.buildUrl({"component": "misc", "page": "display_file", "dir": "results", "file": check.name, "path": check.path}) }}" width="95%" height="1200px" style="border: 0"></iframe>
    {% else %}
        <br>
        <div style="height:23px; float:right;">
            <a id="show_char_{{ index }}_{{ loop.index0 }}" class="btn btn-default" style="float:right;" onclick="changeDiffView('container_{{ index }}_{{ loop.index0 }}', '{{ gradeable.getId() }}', '{{ who }}', '{{ index }}', '{{ loop.index0 }}', 'white_space_helper_{{ index }}')">Visualize whitespace characters</a>
        </div>
        <div><span style="margin-left: 20px" class="line_code" id='white_space_helper_{{ index }}'></span></div>
        <div class="box-block">

            {% if check.actual %}
                {{ self.render_diff_element(check, check.actual, 0, popup_css_file, index, loop.index0) }}
            {% endif %}
            {% if check.expected %}
                {{ self.render_diff_element(check, check.expected, 1, popup_css_file, index, loop.index0) }}
            {% endif %}
            {% if check.difference %}
                {{ self.render_diff_element(check, check.difference, 2, popup_css_file, index, loop.index0) }}
            {% endif %}

        </div>
    {% endif %}

{% endfor %}

{% macro render_diff_element(check, element, side, popup_css_file, index, check_index) %}
    <!-- Readded css here so the popups have the css -->
    <div class='diff-element'>
        <h4>
            {{ element.title }}
            {% if element.show_popup %}
                <span onclick="openPopUp('{{ popup_css_file }}', '{{ element.title }}', {{ index }}, {{ check_index }}, {{ side }});">
                    <i class="fa fa-window-restore" style="cursor: pointer;"></i>
                </span>
            {% endif %}
        </h4>

        <div id="container_{{ index }}_{{ check_index }}_{{ side }}">
            {% for message in check.messages %}
                {% set type_class = "black-message" %}
                {% if message['type'] == "information" %}
                    {% set type_class = "blue-message" %}
                {% elseif message['type'] == "success" %}
                    {% set type_class = "green-message" %}
                {% elseif message['type'] == "failure" %}
                    {% set type_class = "red-message" %}
                {% elseif message['type'] == "warning" %}
                    {% set type_class = "yellow-message" %}
                {% endif %}
                <span class="{{ type_class }}">{{ message['message'] }}</span><br />
            {% endfor %}
            {% if element.type == "image" %}
                <img src="{{ element.src }}" style="border:2px solid black">
            {% elseif element.type == "text" %}
                <div id=div_{{ index }}_{{ check_index }}>
                    {{ element.src|raw }}
                </div>
            {% endif %}
        </div>
    </div>
{% endmacro %}
