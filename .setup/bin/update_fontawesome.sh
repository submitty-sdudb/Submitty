#!/usr/bin/env bash

# Updates FontAwesome 

set -e

THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && pwd )"
DEST=${THIS_DIR}/../../site/public/vendor/fontawesome

rm -rf ${DEST}
mkdir -p ${DEST}

VERSION=5.6.3

echo "Updating FontAwesome to v${VERSION}"
wget https://use.fontawesome.com/releases/v${VERSION}/fontawesome-free-${VERSION}-web.zip -O /tmp/fontawesome.zip
echo "Extracting /tmp/fontawesome.zip"
unzip -u /tmp/fontawesome -d /tmp/fontawesome > /dev/null 2>&1

ZIP_DIR=/tmp/fontawesome/fontawesome-free-${VERSION}-web
echo "Installing webfonts"
mv ${ZIP_DIR}/webfonts ${DEST}
mkdir -p ${DEST}/css

css=( all fontawesome regular solid )
for i in "${css[@]}"; do
    echo "Installing ${i}.min.css"
    echo -e "/*\n   FontAwesome ${VERSION}\n   Generated by .setup/bin/update_fontawesome.sh\n*/" | cat - ${ZIP_DIR}/css/${i}.min.css > /tmp/out && mv /tmp/out ${DEST}/css/${i}.min.css
done

rm -rf /tmp/fontawesome*
